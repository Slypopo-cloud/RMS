generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// 1. User
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String
  name      String
  role      String   @default("CASHIER") // ADMIN, MANAGER, CASHIER, KITCHEN_STAFF
  orders    Order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 2. Menu Management
model MenuCategory {
  id        String     @id @default(cuid())
  name      String
  slug      String     @unique
  items     MenuItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model MenuItem {
  id          String       @id @default(cuid())
  name        String
  description String?
  price       Float
  image       String?
  available   Boolean      @default(true)
  categoryId  String
  category    MenuCategory @relation(fields: [categoryId], references: [id])
  orderItems  OrderItem[]
  recipe      Recipe?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

// 3. Order Management
model Order {
  id            String           @id @default(cuid())
  status        String           @default("PENDING") // PENDING, PREPARING, READY, COMPLETED, CANCELLED
  type          String           @default("DINE_IN") // DINE_IN, TAKEAWAY
  totalAmount   Float
  items         OrderItem[]
  userId        String?
  user          User?            @relation(fields: [userId], references: [id])
  tableId       String?
  restaurantTable RestaurantTable? @relation(fields: [tableId], references: [id])
  paymentStatus String           @default("UNPAID") // UNPAID, PAID, REFUNDED
  payment       Payment?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
}

model OrderItem {
  id         String   @id @default(cuid())
  orderId    String
  order      Order    @relation(fields: [orderId], references: [id])
  menuItemId String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])
  quantity   Int
  price      Float // Snapshot price
}

// 4. Inventory Management
model InventoryItem {
  id                String             @id @default(cuid())
  name              String
  quantity          Int
  unit              String // e.g., 'kg', 'pcs', 'liters'
  threshold         Int // Low stock alert threshold
  recipeIngredients RecipeIngredient[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
}

// 5. Recipe Management
model Recipe {
  id          String             @id @default(cuid())
  menuItemId  String             @unique
  menuItem    MenuItem           @relation(fields: [menuItemId], references: [id])
  ingredients RecipeIngredient[]
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
}

model RecipeIngredient {
  id              String        @id @default(cuid())
  recipeId        String
  recipe          Recipe        @relation(fields: [recipeId], references: [id])
  inventoryItemId String
  inventoryItem   InventoryItem @relation(fields: [inventoryItemId], references: [id])
  quantity        Float // Quantity required per unit of menu item
}

// 6. Table & Reservation Management
model RestaurantTable {
  id           String        @id @default(cuid())
  number       String        @unique
  capacity     Int
  status       String        @default("AVAILABLE") // AVAILABLE, OCCUPIED, RESERVED, OUT_OF_ORDER
  orders       Order[]
  reservations Reservation[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Reservation {
  id            String          @id @default(cuid())
  customerName  String
  customerPhone String?
  guestCount    Int
  startTime     DateTime
  endTime       DateTime?
  status        String          @default("CONFIRMED") // CONFIRMED, CANCELLED, COMPLETED
  tableId       String
  restaurantTable RestaurantTable @relation(fields: [tableId], references: [id])
  notes         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model Payment {
  id        String   @id @default(cuid())
  orderId   String   @unique
  order     Order    @relation(fields: [orderId], references: [id])
  amount    Float
  method    String // CASH, CARD
  status    String   @default("SUCCESS") // SUCCESS, FAILED, REFUNDED
  reference String? // Transaction ID from provider
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
